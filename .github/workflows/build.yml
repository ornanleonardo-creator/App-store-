name: Build Android APK

on:
  workflow_dispatch:  # Permet de lancer manuellement

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ“¥ Checkout code
      uses: actions/checkout@v4
      
    - name: ğŸŸ¢ Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        
    - name: â˜• Setup Java
      uses: actions/setup-java@v4
      with:
        distribution: 'temurin'
        java-version: '17'
        
    - name: ğŸ“„ Create package.json
      run: |
        echo '{
          "name": "mon-app",
          "version": "1.0.0"
        }' > package.json
        
    - name: ğŸ“¦ Install Capacitor
      run: |
        npm install -g @capacitor/cli
        npm install @capacitor/core @capacitor/android
        
    - name: ğŸš€ Init Capacitor
      run: |
        npx cap init "Mon App" "com.monapp.android" --web-dir .
        
    - name: ğŸ¤– Add Android
      run: |
        npx cap add android
        
    - name: ğŸ”„ Sync
      run: |
        npx cap sync
        
    - name: ğŸ—ï¸ Build APK
      run: |
        cd android
        chmod +x gradlew
        ./gradlew assembleDebug
        
    - name: ğŸ“¤ Upload APK
      uses: actions/upload-artifact@v4
      with:
        name: app-android
        path: android/app/build/outputs/apk/debug/app-debug.apk
        
    - name: âœ… Done
      run: echo "ğŸ‰ APK prÃªt! TÃ©lÃ©charge dans Artifacts"
