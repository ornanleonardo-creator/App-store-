name: ğŸ—ï¸ Build Android APK

on:
  push:
    branches: [ main ]
  workflow_dispatch:  # Permet de lancer manuellement

jobs:
  build-android:
    runs-on: ubuntu-latest
    
    steps:
    # 1. TÃ©lÃ©charger le code
    - name: ğŸ“¥ Checkout du code
      uses: actions/checkout@v4
      
    # 2. Installer Node.js
    - name: ğŸŸ¢ Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        
    # 3. Installer Java (nÃ©cessaire pour Android)
    - name: â˜• Setup Java
      uses: actions/setup-java@v4
      with:
        distribution: 'temurin'
        java-version: '17'
        
    # 4. CrÃ©er package.json minimal
    - name: ğŸ“„ CrÃ©er package.json
      run: |
        echo '{
          "name": "mon-app-android",
          "version": "1.0.0",
          "description": "Application Android crÃ©Ã©e sans PC",
          "main": "index.html",
          "scripts": {
            "build": "echo Build terminÃ©"
          },
          "dependencies": {},
          "devDependencies": {}
        }' > package.json
        
    # 5. Installer Capacitor
    - name: ğŸ“¦ Installer Capacitor
      run: |
        npm install -g @capacitor/cli
        npm install @capacitor/core @capacitor/android
        
    # 6. Initialiser le projet Capacitor
    - name: ğŸš€ Initialiser Capacitor
      run: |
        npx cap init "Mon App Android" "com.monapp.android"
        
    # 7. Ajouter la plateforme Android
    - name: ğŸ¤– Ajouter Android
      run: |
        npx cap add android
        
    # 8. Synchroniser les fichiers
    - name: ğŸ”„ Synchroniser
      run: |
        npx cap sync
        
    # 9. Builder l'APK Debug
    - name: ğŸ› ï¸ Builder APK Debug
      run: |
        cd android
        chmod +x gradlew
        ./gradlew assembleDebug --no-daemon
        
    # 10. TÃ©lÃ©verser l'APK
    - name: ğŸ“¤ TÃ©lÃ©verser APK
      uses: actions/upload-artifact@v4
      with:
        name: mon-app-android
        path: android/app/build/outputs/apk/debug/app-debug.apk
        retention-days: 7
        
    # 11. Message de succÃ¨s
    - name: âœ… SuccÃ¨s !
      run: |
        echo "========================================"
        echo "ğŸ‰ FÃ‰LICITATIONS !"
        echo "ğŸ“± Ton APK Android a Ã©tÃ© crÃ©Ã© avec succÃ¨s !"
        echo ""
        echo "ğŸ“¥ Pour le tÃ©lÃ©charger :"
        echo "1. Va dans l'onglet 'Actions'"
        echo "2. Clique sur le dernier workflow"
        echo "3. Descends dans 'Artifacts'"
        echo "4. TÃ©lÃ©charge 'mon-app-android'"
        echo "========================================"
